<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Reeta — AI Org Psychologist (Demo)</title>
  <style>
    :root { --bg:#0b0f1a; --fg:#fff; --accent:#00ffd1; }
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }
    main{
      min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;
      text-align:center;padding:3rem 1rem 220px;box-sizing:border-box;
    }
    h1{font-size:1.5rem;margin:0}
    p{font-size:1rem;max-width:520px;line-height:1.5;margin:.75rem auto 0;opacity:.9}
    a.btn{
      display:inline-block;margin-top:1rem;background:var(--accent);color:#000;
      padding:.75rem 1.5rem;border-radius:10px;font-weight:700;text-decoration:none;
    }

    /* Avatar bubble */
    #heygen-streaming-embed{
      z-index:40;position:fixed;right:24px;bottom:24px;width:180px;height:180px;
      border-radius:50%;border:2px solid #fff;box-shadow:0 8px 24px rgba(0,0,0,.18);
      overflow:hidden;background:#000;cursor:pointer;
      transform-origin:bottom right;transform:scale(1);
      transition:transform .28s ease-in-out,opacity .2s ease,visibility .2s ease,border-radius .28s ease;
      opacity:0;visibility:hidden;
    }
    #heygen-streaming-embed.show{opacity:1;visibility:visible}
    /* Auto: speaking => 2x */
    #heygen-streaming-embed.talking{transform:scale(2)}
    /* Manual: click => 3x (wins if both set) */
    #heygen-streaming-embed.fullsize{transform:scale(3)}
    #heygen-streaming-container,#heygen-streaming-container iframe{width:100%;height:100%;display:block;border:0}
    @media (prefers-reduced-motion:reduce){#heygen-streaming-embed{transition:none}}
  </style>
</head>
<body>
  <main>
    <h1 id="title">Meet Reeta — Your AI-Powered Management Due Diligence Psychologist</h1>
    <p>
      Powered by Yareta.ai, this avatar is trained on proprietary behavioral science and investor knowledge
      of the AsiaVerify Management.
    </p>
    <a id="reportLink" class="btn"
       href="https://drive.google.com/file/d/1lkhhtMlkDvWcuIjdbAO3WOBOcLmlWR48/view?usp=sharing"
       target="_blank" rel="noopener noreferrer">View Report</a>
  </main>

  <script>
    // ----- Read URL parameters for per-client customization -----
    (function(){
      var qs = new URLSearchParams(location.search);
      var title = qs.get('title');
      var report = qs.get('report');
      var share = qs.get('share');

      if (title) document.getElementById('title').textContent = title;
      if (report) document.getElementById('reportLink').setAttribute('href', report);

      // Default Heygen share token (you can keep this or override via ?share=...)
      window.HEYGEN_SHARE = (share || 'eyJxdWFsaXR5IjoiaGlnaCIsImF2YXRhck5hbWUiOiJLYXR5YV9DaGFpcl9TaXR0aW5nX3B1YmxpYyIsInByZXZpZXdJbWciOiJodHRwczovL2ZpbGVzMi5oZXlnZW4uYWkvYXZhdGFyL3YzL2IxZmY1ZWRiZjk2MjQyZTZhYzk0NjkyMjdkZjQwOTI0XzU1MzYwL3ByZXZpZXdfdGFyZ2V0LndlYnAiLCJuZWVkUmVtb3ZlQmFja2dyb3VuZCI6ZmFsc2UsImtub3dsZWRnZUJhc2VJZCI6IjBlMjYwNDNkMmE4ODQ3MjJiMzY1N2UzMGYzYTk1NDM0IiwidXNlcm5hbWUiOiI2MDBmZWJhMjdhNmU0ODg5OWZlMDI2NDdlYWNkODFlMSJ9').trim();
    })();
  </script>

  <!-- Embed + behavior -->
  <script>
    (function () {
      var share = (window.HEYGEN_SHARE || '').trim();
      var host = "https://labs.heygen.com";
      var url = host + "/guest/streaming-embed?share=" + encodeURIComponent(share) + "&inIFrame=1";

      // Wrapper + container
      var wrapDiv = document.createElement("div");
      wrapDiv.id = "heygen-streaming-embed";

      var container = document.createElement("div");
      container.id = "heygen-streaming-container";

      // Iframe
      var iframe = document.createElement("iframe");
      iframe.src = url;
      iframe.allow = "microphone; camera; clipboard-read; clipboard-write; autoplay; encrypted-media;";
      iframe.referrerPolicy = "origin-when-cross-origin";

      // Mount
      container.appendChild(iframe);
      wrapDiv.appendChild(container);
      document.body.appendChild(wrapDiv);

      // Reveal when loaded
      iframe.addEventListener("load", function () {
        wrapDiv.classList.add("show");
      });

      // Click => toggle 3x
      document.addEventListener("click", function (e) {
        var t = e.target;
        var w = t && t.closest ? t.closest("#heygen-streaming-embed") : null;
        if (w) w.classList.toggle("fullsize");
      });

      // Auto 2x while speaking (only accept messages from our iframe)
      var talking = false;
      var deb = null;
      function setTalk(v){ talking = v; wrapDiv.classList.toggle("talking", talking); }

      window.addEventListener("message", function (e) {
        if (e.source !== iframe.contentWindow) return; // only react to our embed

        var d = e.data;
        if (typeof d === "string") { try { d = JSON.parse(d); } catch (_) {} }
        var raw = (d && (d.type || d.event || d.name || (d.detail && (d.detail.type || d.detail.event)))) || "";
        var t = String(raw).toUpperCase();

        var start = t === "AVATAR_START_TALKING" || t === "TALKING_START" || t === "AVATAR.TALKING_START" || raw === "avatar_start_talking";
        var stop  = t === "AVATAR_STOP_TALKING"  || t === "TALKING_END"   || t === "AVATAR.TALKING_STOP"  || raw === "avatar_stop_talking";
        var tick  = t === "AVATAR_TALKING_MESSAGE" || raw === "avatar_talking_message";

        if (start) setTalk(true);
        else if (stop) setTalk(false);
        else if (tick) { setTalk(true); clearTimeout(deb); deb = setTimeout(function(){ setTalk(false); }, 900); }
      });
    })();
  </script>
</body>
</html>
